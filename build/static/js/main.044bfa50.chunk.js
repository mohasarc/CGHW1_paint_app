(this["webpackJsonpreact-typescript"]=this["webpackJsonpreact-typescript"]||[]).push([[0],{102:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"_argumentsToArray",(function(){return z})),n.d(a,"radians",(function(){return U})),n.d(a,"vec2",(function(){return M})),n.d(a,"vec3",(function(){return G})),n.d(a,"vec4",(function(){return X})),n.d(a,"mat2",(function(){return q})),n.d(a,"mat3",(function(){return W})),n.d(a,"mat4",(function(){return J})),n.d(a,"equal",(function(){return H})),n.d(a,"add",(function(){return V})),n.d(a,"subtract",(function(){return K})),n.d(a,"mult",(function(){return Q})),n.d(a,"translate",(function(){return Z})),n.d(a,"rotate",(function(){return $})),n.d(a,"scale",(function(){return ee})),n.d(a,"lookAt",(function(){return te})),n.d(a,"ortho",(function(){return ne})),n.d(a,"perspective",(function(){return ae})),n.d(a,"transpose",(function(){return re})),n.d(a,"dot",(function(){return ie})),n.d(a,"negate",(function(){return se})),n.d(a,"cross",(function(){return ce})),n.d(a,"length",(function(){return oe})),n.d(a,"normalize",(function(){return le})),n.d(a,"mix",(function(){return ue})),n.d(a,"scaleSU",(function(){return he})),n.d(a,"flatten",(function(){return fe})),n.d(a,"sizeof",(function(){return de}));var r=n(57),i=(n(93),n(139)),s=n(128),c=n(132),o=n(26),l=n(7),u=n(59),h=n(60),f=function(){function e(){Object(u.a)(this,e),this.state={}}return Object(h.a)(e,[{key:"subscribe",value:function(e,t){this.state[e]||(this.state[e]={val:void 0,cbs:[]}),this.state[e].cbs=[].concat(Object(l.a)(this.state[e].cbs),[t])}},{key:"getState",value:function(e){return this.state[e]?this.state[e].val:null}},{key:"setState",value:function(e,t){this.state[e]||(this.state[e]={val:void 0,cbs:[]}),this.state[e]=Object(o.a)(Object(o.a)({},this.state[e]),{},{val:t}),this.state[e].cbs.forEach((function(e){e()}))}},{key:"serialize",value:function(){var e=Object(o.a)({},this.state);return Object.keys(e).forEach((function(t){e[t].cbs=[]})),JSON.stringify(e)}},{key:"initWith",value:function(e){var t=this,n=JSON.parse(JSON.parse(e));Object.keys(this.state).forEach((function(e){void 0!==n[e]?t.setState(e,n[e].val):console.warn("COULDNT FIND DATA")}))}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();f.instance=void 0;var d=n(14),g=n(125),b=n(129),p=n(131),v=n(133),x=n(126),y=n(122),m=n(134),j=n(135),O=n(136),w=n(69),S=n.n(w),I=n(65),A=n.n(I),R=n(66),E=n.n(R),L=n(63),F=n.n(L),D=n(67),k=n.n(D),B=n(68),C=n.n(B),T=n(2),_=n(0),P=1;function Y(){var e=Object(T.useState)(f.getInstance().getState("layers")),t=Object(d.a)(e,2),n=t[0],a=t[1],r=Object(T.useState)(f.getInstance().getState("selectedLayer")),i=Object(d.a)(r,2),u=i[0],h=i[1];return f.getInstance().subscribe("layers",(function(){a(f.getInstance().getState("layers"))})),f.getInstance().subscribe("selectedLayer",(function(){h(f.getInstance().getState("selectedLayer"))})),Object(_.jsxs)(g.a,{children:[Object(_.jsx)(b.a,{title:"Layers",titleTypographyProps:{variant:"body2",align:"center",color:"common.white"},style:{backgroundColor:"#323638"}}),Object(_.jsx)(p.a,{style:{backgroundColor:"#3b4245"},children:Object(_.jsx)(c.a,{sx:{width:"100%",height:142},children:Object(_.jsxs)(v.a,{sx:{width:"100%",height:"100%",bgcolor:"background.dark",position:"relative",overflow:"auto","& ul":{padding:0}},style:{backgroundColor:"#3b4245"},children:[Object(_.jsx)(x.a,{children:Object(_.jsx)(y.a,{style:{width:"100%"},onClick:function(){var e={name:"New Layer (".concat(P+1,")"),z_index:n.length,visible:!0,id:"".concat(P++),shapes:[],vertexData:[],colorData:[],brushSizeData:[],boundingRectData:[]};f.getInstance().setState("layers",[Object(o.a)({},e)].concat(Object(l.a)(n))),f.getInstance().setState("selectedLayer",e.id)},children:Object(_.jsx)(F.a,{style:{width:"100%"},sx:{color:"white"}})})}),n.map((function(e){return Object(_.jsx)(x.a,{style:{backgroundColor:e.id===u?"#1e2224":""},children:Object(_.jsxs)(s.a,{container:!0,rowSpacing:1,columns:{xs:12,sm:12,md:12},children:[Object(_.jsx)(s.a,{item:!0,xs:2,sm:2,md:2,children:Object(_.jsx)(c.a,{children:Object(_.jsx)(m.a,{id:e.id,onClick:function(e){!function(e){var t=n.find((function(t){return t.id===e}));t.visible=!t.visible;var a=n.map((function(e){return e.id==t.id?t:e}));f.getInstance().setState("layers",Object(l.a)(a))}(e.currentTarget.id)},children:e.visible?Object(_.jsx)(A.a,{sx:{color:"white"}}):Object(_.jsx)(E.a,{sx:{color:"white"}})})})}),Object(_.jsx)(s.a,{item:!0,xs:4,sm:4,md:4,children:Object(_.jsx)(c.a,{children:Object(_.jsx)(y.a,{id:e.id,onClick:function(e){var t;t=e.currentTarget.id,f.getInstance().setState("selectedLayer",t)},children:Object(_.jsx)(j.a,{primary:e.name,primaryTypographyProps:{variant:"body2",align:"left",color:"common.white"}})})})}),Object(_.jsx)(s.a,{item:!0,xs:6,sm:6,md:6,children:Object(_.jsxs)(O.a,{children:[Object(_.jsx)(m.a,{id:e.id,onClick:function(e){!function(e){for(var t=Object(l.a)(n),a=-1,r=0;r<n.length;r++)n[r].id===e&&(a=r);a>0&&a<n.length&&(t[a]=n[a-1],t[a-1]=n[a]),f.getInstance().setState("layers",Object(l.a)(t))}(e.currentTarget.id)},children:Object(_.jsx)(k.a,{sx:{color:"white"}})}),Object(_.jsx)(m.a,{id:e.id,onClick:function(e){!function(e){for(var t=Object(l.a)(n),a=-1,r=0;r<n.length;r++)n[r].id===e&&(a=r);a>=0&&a<n.length-1&&(t[a]=n[a+1],t[a+1]=n[a]),f.getInstance().setState("layers",Object(l.a)(t))}(e.currentTarget.id)},children:Object(_.jsx)(C.a,{sx:{color:"white"}})}),Object(_.jsx)(m.a,{id:e.id,onClick:function(e){!function(e){var t=n.filter((function(t){return t.id!==e})),a=f.getInstance().getState("selectedLayer");f.getInstance().setState("layers",Object(l.a)(t)),a===e&&f.getInstance().setState("selectedLayer",t[0]?t[0].id:"")}(e.currentTarget.id)},children:Object(_.jsx)(S.a,{sx:{color:"white"}})})]})})]})})}))]})})})]})}var N=n(137);function z(e){return[].concat.apply([],Array.prototype.slice.apply(e))}function U(e){return e*Math.PI/180}function M(){var e=z(arguments);switch(e.length){case 0:e.push(0);case 1:e.push(0)}return e.splice(0,2)}function G(){var e=z(arguments);switch(e.length){case 0:e.push(0);case 1:e.push(0);case 2:e.push(0)}return e.splice(0,3)}function X(){var e=z(arguments);switch(e.length){case 0:e.push(0);case 1:e.push(0);case 2:e.push(0);case 3:e.push(1)}return e.splice(0,4)}function q(){var e=z(arguments),t=[];switch(e.length){case 0:e[0]=1;case 1:t=[M(e[0],0),M(0,e[0])];break;default:t.push(M(e)),e.splice(0,2),t.push(M(e))}return t.matrix=!0,t}function W(){var e=z(arguments),t=[];switch(e.length){case 0:e[0]=1;case 1:t=[G(e[0],0,0),G(0,e[0],0),G(0,0,e[0])];break;default:t.push(G(e)),e.splice(0,3),t.push(G(e)),e.splice(0,3),t.push(G(e))}return t.matrix=!0,t}function J(){var e=z(arguments),t=[];switch(e.length){case 0:e[0]=1;case 1:t=[X(e[0],0,0,0),X(0,e[0],0,0),X(0,0,e[0],0),X(0,0,0,e[0])];break;default:t.push(X(e)),e.splice(0,4),t.push(X(e)),e.splice(0,4),t.push(X(e)),e.splice(0,4),t.push(X(e))}return t.matrix=!0,t}function H(e,t){if(e.length!=t.length)return!1;if(e.matrix&&t.matrix)for(var n=0;n<e.length;++n){if(e[n].length!=t[n].length)return!1;for(var a=0;a<e[n].length;++a)if(e[n][a]!==t[n][a])return!1}else{if(e.matrix&&!t.matrix||!e.matrix&&t.matrix)return!1;for(n=0;n<e.length;++n)if(e[n]!==t[n])return!1}return!0}function V(e,t){var n=[];if(e.matrix&&t.matrix){if(e.length!=t.length)throw"add(): trying to add matrices of different dimensions";for(var a=0;a<e.length;++a){if(e[a].length!=t[a].length)throw"add(): trying to add matrices of different dimensions";n.push([]);for(var r=0;r<e[a].length;++r)n[a].push(e[a][r]+t[a][r])}return n.matrix=!0,n}if(e.matrix&&!t.matrix||!e.matrix&&t.matrix)throw"add(): trying to add matrix and non-matrix variables";if(e.length!=t.length)throw"add(): vectors are not the same dimension";for(a=0;a<e.length;++a)n.push(e[a]+t[a]);return n}function K(e,t){var n=[];if(e.matrix&&t.matrix){if(e.length!=t.length)throw"subtract(): trying to subtract matrices of different dimensions";for(var a=0;a<e.length;++a){if(e[a].length!=t[a].length)throw"subtract(): trying to subtact matrices of different dimensions";n.push([]);for(var r=0;r<e[a].length;++r)n[a].push(e[a][r]-t[a][r])}return n.matrix=!0,n}if(e.matrix&&!t.matrix||!e.matrix&&t.matrix)throw"subtact(): trying to subtact  matrix and non-matrix variables";if(e.length!=t.length)throw"subtract(): vectors are not the same length";for(a=0;a<e.length;++a)n.push(e[a]-t[a]);return n}function Q(e,t){var n=[];if(e.matrix&&t.matrix){if(e.length!=t.length)throw"mult(): trying to add matrices of different dimensions";for(var a=0;a<e.length;++a)if(e[a].length!=t[a].length)throw"mult(): trying to add matrices of different dimensions";for(a=0;a<e.length;++a){n.push([]);for(var r=0;r<t.length;++r){for(var i=0,s=0;s<e.length;++s)i+=e[a][s]*t[s][r];n[a].push(i)}}return n.matrix=!0,n}if(e.length!=t.length)throw"mult(): vectors are not the same dimension";for(a=0;a<e.length;++a)n.push(e[a]*t[a]);return n}function Z(e,t,n){Array.isArray(e)&&3==e.length&&(n=e[2],t=e[1],e=e[0]);var a=J();return a[0][3]=e,a[1][3]=t,a[2][3]=n,a}function $(e,t){Array.isArray(t)||(t=[arguments[1],arguments[2],arguments[3]]);var n=le(t),a=n[0],r=n[1],i=n[2],s=Math.cos(U(e)),c=1-s,o=Math.sin(U(e)),l=J(X(a*a*c+s,a*r*c-i*o,a*i*c+r*o,0),X(a*r*c+i*o,r*r*c+s,r*i*c-a*o,0),X(a*i*c-r*o,r*i*c+a*o,i*i*c+s,0),X());return l}function ee(e,t,n){Array.isArray(e)&&3==e.length&&(n=e[2],t=e[1],e=e[0]);var a=J();return a[0][0]=e,a[1][1]=t,a[2][2]=n,a}function te(e,t,n){if(!Array.isArray(e)||3!=e.length)throw"lookAt(): first parameter [eye] must be an a vec3";if(!Array.isArray(t)||3!=t.length)throw"lookAt(): first parameter [at] must be an a vec3";if(!Array.isArray(n)||3!=n.length)throw"lookAt(): first parameter [up] must be an a vec3";if(H(e,t))return J();var a=le(K(t,e)),r=le(ce(a,n)),i=le(ce(r,a));return a=se(a),J(X(r,-ie(r,e)),X(i,-ie(i,e)),X(a,-ie(a,e)),X())}function ne(e,t,n,a,r,i){if(e==t)throw"ortho(): left and right are equal";if(n==a)throw"ortho(): bottom and top are equal";if(r==i)throw"ortho(): near and far are equal";var s=t-e,c=a-n,o=i-r,l=J();return l[0][0]=2/s,l[1][1]=2/c,l[2][2]=-2/o,l[0][3]=-(e+t)/s,l[1][3]=-(a+n)/c,l[2][3]=-(r+i)/o,l}function ae(e,t,n,a){var r=1/Math.tan(U(e)/2),i=a-n,s=J();return s[0][0]=r/t,s[1][1]=r,s[2][2]=-(n+a)/i,s[2][3]=-2*n*a/i,s[3][2]=-1,s[3][3]=0,s}function re(e){if(!e.matrix)return"transpose(): trying to transpose a non-matrix";for(var t=[],n=0;n<e.length;++n){t.push([]);for(var a=0;a<e[n].length;++a)t[n].push(e[a][n])}return t.matrix=!0,t}function ie(e,t){if(e.length!=t.length)throw"dot(): vectors are not the same dimension";for(var n=0,a=0;a<e.length;++a)n+=e[a]*t[a];return n}function se(e){for(var t=[],n=0;n<e.length;++n)t.push(-e[n]);return t}function ce(e,t){if(!Array.isArray(e)||e.length<3)throw"cross(): first argument is not a vector of at least 3";if(!Array.isArray(t)||t.length<3)throw"cross(): second argument is not a vector of at least 3";return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function oe(e){return Math.sqrt(ie(e,e))}function le(e,t){if(t)var n=e.pop();var a=oe(e);if(!isFinite(a))throw"normalize: vector "+e+" has zero length";for(var r=0;r<e.length;++r)e[r]/=a;return t&&e.push(n),e}function ue(e,t,n){if("number"!==typeof n)throw"mix: the last paramter "+n+" must be a number";if(e.length!=t.length)throw"vector dimension mismatch";for(var a=[],r=0;r<e.length;++r)a.push((1-n)*e[r]+n*t[r]);return a}function he(e,t){if(!Array.isArray(t))throw"scale: second parameter "+t+" is not a vector";for(var n=[],a=0;a<t.length;++a)n.push(e*t[a]);return n}function fe(e){!0===e.matrix&&(e=re(e));var t=e.length,n=!1;Array.isArray(e[0])&&(n=!0,t*=e[0].length);var a=new Float32Array(t);if(n)for(var r=0,i=0;i<e.length;++i)for(var s=0;s<e[i].length;++s)a[r++]=e[i][s];else for(i=0;i<e.length;++i)a[i]=e[i];return a}var de={vec2:new Float32Array(fe(M())).byteLength,vec3:new Float32Array(fe(G())).byteLength,vec4:new Float32Array(fe(X())).byteLength,mat2:new Float32Array(fe(q())).byteLength,mat3:new Float32Array(fe(W())).byteLength,mat4:new Float32Array(fe(J())).byteLength};function ge(e,t,n){var a,r;if(void 0===t)return alert("Unable to load vertex shader "),-1;if(a=e.createShader(e.VERTEX_SHADER),e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS)){var i="Vertex shader failed to compile.  The error log is:<pre>"+e.getShaderInfoLog(a)+"</pre>";return alert(i),-1}if(void 0===n)return alert("Unable to load Fragment shader "),-1;if(r=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){i="Fragment shader failed to compile.  The error log is:<pre>"+e.getShaderInfoLog(r)+"</pre>";return alert(i),-1}var s=e.createProgram();if(e.attachShader(s,a),e.attachShader(s,r),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){i="Shader program failed to link.  The error log is:<pre>"+e.getProgramInfoLog(s)+"</pre>";return alert(i),-1}return s}var be=function(){var e=function(e,t){for(var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],a=null,r=0;r<n.length;++r){try{a=e.getContext(n[r],t)}catch(i){}if(a)break}return a};return{create3DContext:e,setupWebGL:function(t,n){function a(e){var n=t.parentNode;n&&(n.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>")}if(!window.WebGLRenderingContext)return a('This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>'),null;var r=e(t,n);return r||a('It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'),r}}}();window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)};var pe="\n        attribute vec4 vPosition;\n        attribute vec4 vColor;\n    \n        varying vec4 fColor;\n    \n        void\n        main()\n        {\n            gl_Position = vPosition;\n            fColor = vColor;\n        }\n    ",ve="\n        precision mediump float;\n    \n        varying vec4 fColor;\n        void\n        main()\n        {\n            gl_FragColor = fColor;\n        }\n    ",xe="\n        attribute vec4 vPosition;\n        attribute vec4 vColor;\n        attribute float vBrushSize;\n        attribute vec4 vBindingRect; // xywh\n        \n        varying vec4 fColor;\n        varying vec4 fBindingRect;\n        \n        void\n        main()\n        {\n            gl_Position = vPosition;\n            fColor = vColor;\n            fBindingRect = vBindingRect;\n            gl_PointSize = vBrushSize;\n        }\n    ",ye="\n        // src = https://www.desultoryquest.com/blog/drawing-anti-aliased-circular-points-using-opengl-slash-webgl/\n        precision mediump float;\n\n        varying vec4 fColor;\n        varying vec4 fBindingRect;\n\n        void\n        main()\n        {\n            float r = 0.0, delta = 0.0, alpha = 1.0;\n            vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n            r = dot(cxy, cxy);\n            if (r > 1.0) {\n                discard;\n            }\n\n            if (\n                gl_FragCoord.x > fBindingRect.x && gl_FragCoord.x < fBindingRect.x + fBindingRect.z \n                && gl_FragCoord.y > fBindingRect.y && gl_FragCoord.y < fBindingRect.y + fBindingRect.w\n            ) {\n                gl_FragColor = fColor * (alpha);\n            } else {\n                discard;\n            }\n        }    \n    ";function me(e,t,n,a,r,i,s){e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,4*i*r,e.STATIC_DRAW);var c=e.getAttribLocation(t,n);e.vertexAttribPointer(c,i,s,!1,0,0),e.enableVertexAttribArray(c)}var je=[X(0,0,0,1),X(1,0,0,1),X(1,1,0,1),X(0,1,0,1),X(0,1,1,1),X(0,0,1,1),X(1,0,1,1),X(1,1,1,1)];function Oe(){var e=Object(T.useState)({x:-100,y:-100}),t=Object(d.a)(e,2),n=t[0],a=t[1];return f.getInstance().subscribe("color-picker-pos",(function(){var e=f.getInstance().getState("color-picker-pos");e&&a(e)})),Object(_.jsx)("svg",{id:"selector-circle",height:"10",width:"10",style:{position:"absolute",top:n.y-5,left:n.x-5},children:Object(_.jsx)("circle",{cx:"5",cy:"5",r:"4",stroke:"black","stroke-width":"1","fill-opacity":0})})}function we(){f.getInstance().setState("hue-picked",[0,1,1,1]),f.getInstance().setState("hue-pos",.5),Object(T.useEffect)(Ae),Object(T.useEffect)(Ie);return Object(_.jsx)("div",{children:Object(_.jsxs)(g.a,{children:[Object(_.jsx)(b.a,{title:"Color Picker",titleTypographyProps:{variant:"body2",align:"center",color:"common.white"},style:{backgroundColor:"#323638"}}),Object(_.jsxs)(p.a,{style:{backgroundColor:"#3b4245"},children:[Object(_.jsx)("canvas",{id:"saturation-canvas"}),Object(_.jsx)(Oe,{}),Object(_.jsx)("canvas",{id:"hue-canvas",style:{height:25,width:300,paddingBottom:20}}),Object(_.jsx)(s.a,{container:!0,rowSpacing:1,columns:{xs:12,sm:12,md:12},columnSpacing:{xs:1,sm:2,md:3},children:["#41b96c","#06c1d9","#fed37a","#e45b06","#06486c","#534430","#eb4956","#b838ed"].map((function(e){return Object(_.jsx)(s.a,{item:!0,xs:12,sm:6,md:3,children:Object(_.jsx)(N.a,{id:e,variant:"contained",style:{borderRadius:100,backgroundColor:e,padding:"10px 20px"},onClick:Se})})}))})]})]})})}function Se(e){var t=function(e){if(6!=e.length)throw"Only six-digit hex colors are allowed.";var t=e.match(/.{1,2}/g);if(!t)throw new Error("Corrupt hex");return[parseInt(t[0],16),parseInt(t[1],16),parseInt(t[2],16)]}(e.target.id.substr(1));f.getInstance().setState("picked-color",[].concat(Object(l.a)(t.map((function(e){return e/255}))),[1]))}function Ie(){var e=document.getElementById("hue-canvas"),t=document.getElementById("saturation-canvas");if(!e||!t)throw new Error("Couldn't find the canvas");var n=be.setupWebGL(e,{preserveDrawingBuffer:!0});if(!n)throw new Error("WebGL isn't available");n.viewport(0,0,e.width,e.height),n.clearColor(254/255,254/255,.8,1);var a=ge(n,pe,ve);n.useProgram(a);var r=n.createBuffer();r&&me(n,a,"vPosition",r,14,2,n.FLOAT);var i=n.createBuffer();i&&me(n,a,"vColor",i,14,4,n.FLOAT);var s=!1;e.addEventListener("mousedown",(function(){s=!0})),e.addEventListener("mouseup",(function(){s=!1})),e.addEventListener("mousemove",(function(e){s&&h({x:e.clientX,y:e.clientY})})),e.addEventListener("click",(function(e){h({x:e.clientX,y:e.clientY})}));for(var c=[],o=[],l=-1,u=0;l<1;l+=2/6,u++)c.push(M(l,1),M(l,-1)),o.push(X(je[u%6+1]),X(je[u%6+1]));function h(a){var r=M(a.x-e.offsetLeft,e.height-a.y+e.offsetTop),i=new Uint8Array(4);n.readPixels(r[0],r[1],1,1,n.RGBA,n.UNSIGNED_BYTE,i),f.getInstance().setState("hue-picked",[i[0]/255,i[1]/255,i[2]/255,i[3]/255]),f.getInstance().setState("hue-pos",r[0]/e.width),f.getInstance().setState("picked-color",[i[0]/255,i[1]/255,i[2]/255,i[3]/255]),f.getInstance().setState("color-picker-pos",{x:a.x,y:t.offsetTop+t.height})}n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferSubData(n.ARRAY_BUFFER,0,fe(c)),n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferSubData(n.ARRAY_BUFFER,0,fe(o)),n.clear(n.COLOR_BUFFER_BIT),n.drawArrays(n.TRIANGLE_STRIP,0,14)}function Ae(){var e=document.getElementById("saturation-canvas"),t=document.getElementById("selector-circle");if(!e||!t)throw new Error("Couldn't find the canvas");var n=be.setupWebGL(e,{preserveDrawingBuffer:!0});if(!n)throw new Error("WebGL isn't available");n.viewport(0,0,e.width,e.height),n.clearColor(59/255,66/255,69/255,1);var a=ge(n,pe,ve);n.useProgram(a);var r=n.createBuffer();r&&me(n,a,"vPosition",r,3,2,n.FLOAT);var i=n.createBuffer();i&&me(n,a,"vColor",i,3,4,n.FLOAT);var s=!1;function c(t){var a=M(t.x-e.offsetLeft,e.height-t.y+e.offsetTop),r=new Uint8Array(4);n.readPixels(a[0],a[1],1,1,n.RGBA,n.UNSIGNED_BYTE,r),f.getInstance().setState("picked-color",[r[0]/255,r[1]/255,r[2]/255,r[3]/255]),f.getInstance().setState("color-picker-pos",{x:t.x,y:t.y})}function o(){n.clear(n.COLOR_BUFFER_BIT);var e=[X(je[7]),X(je[0]),f.getInstance().getState("hue-picked")];n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferSubData(n.ARRAY_BUFFER,0,fe(e));var t=[M(-1,1),M(1,1),M(2*f.getInstance().getState("hue-pos")-1,-1)];n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferSubData(n.ARRAY_BUFFER,0,fe(t)),n.drawArrays(n.TRIANGLE_FAN,0,3)}e.addEventListener("mousedown",(function(){s=!0})),e.addEventListener("mouseup",(function(){s=!1})),e.addEventListener("mousemove",(function(e){s&&c({x:e.clientX,y:e.clientY})})),e.addEventListener("click",(function(e){c({x:e.clientX,y:e.clientY})})),t.addEventListener("mousedown",(function(){s=!0})),t.addEventListener("mouseup",(function(){s=!1})),t.addEventListener("mousemove",(function(e){s&&c({x:e.clientX,y:e.clientY})})),t.addEventListener("click",(function(e){c({x:e.clientX,y:e.clientY})})),f.getInstance().subscribe("hue-picked",o),f.getInstance().subscribe("hue-pos",o),o()}var Re=n(138),Ee=n(124),Le=n(70),Fe=n.n(Le),De=n(73),ke=n.n(De),Be=n(74),Ce=n.n(Be),Te=n(75),_e=n.n(Te),Pe=n(72),Ye=n.n(Pe),Ne=n(71),ze=n.n(Ne);function Ue(){var e=Object(T.useState)("#000000"),t=Object(d.a)(e,2),n=t[0],a=t[1],r=Object(T.useState)(0),i=Object(d.a)(r,2),o=i[0],l=i[1],u=Object(T.useState)("brush"),h=Object(d.a)(u,2),v=h[0],x=h[1];return f.getInstance().subscribe("picked-color",(function(){var e=f.getInstance().getState("picked-color");a("#"+e.map((function(e){return 255*e})).map((function(e){var t=e.toString(16);return 1===t.length?"0"+t:t})).join(""))})),f.getInstance().subscribe("selected-tool",(function(){x(f.getInstance().getState("selected-tool"))})),f.getInstance().subscribe("brush-size",(function(){l(f.getInstance().getState("brush-size"))})),Object(_.jsxs)(g.a,{children:[Object(_.jsx)(b.a,{title:"Tool Box",titleTypographyProps:{variant:"body2",align:"center",color:"common.white"},style:{backgroundColor:"#323638"}}),Object(_.jsxs)(p.a,{style:{backgroundColor:"#3b4245"},children:[Object(_.jsx)(c.a,{pb:2,children:Object(_.jsxs)(s.a,{container:!0,rowSpacing:1,columns:{xs:12,sm:12,md:12},children:[Object(_.jsx)(s.a,{item:!0,xs:12,sm:12,md:6,children:Object(_.jsx)(N.a,{variant:"brush"===v?"outlined":"text",onClick:function(){f.getInstance().setState("selected-tool","brush")},children:Object(_.jsx)(Fe.a,{sx:{color:"white"}})})}),Object(_.jsx)(s.a,{item:!0,xs:12,sm:12,md:6,children:Object(_.jsx)(N.a,{variant:"eraser"===v?"outlined":"text",onClick:function(){f.getInstance().setState("selected-tool","eraser")},children:Object(_.jsx)(ze.a,{sx:{color:"white"}})})}),Object(_.jsx)(s.a,{item:!0,xs:12,sm:12,md:6,children:Object(_.jsx)(N.a,{variant:"crop"===v?"outlined":"text",onClick:function(){f.getInstance().setState("selected-tool","crop")},children:Object(_.jsx)(Ye.a,{sx:{color:"white"}})})})]})}),Object(_.jsx)(Re.a,{}),Object(_.jsx)(c.a,{pt:2,children:Object(_.jsxs)(s.a,{container:!0,rowSpacing:1,columns:{xs:12,sm:12,md:12},children:[Object(_.jsx)(s.a,{item:!0,xs:12,sm:12,md:6,children:Object(_.jsx)(N.a,{variant:"rect"===v?"outlined":"text",onClick:function(){f.getInstance().setState("selected-tool","rect")},children:Object(_.jsx)(ke.a,{sx:{color:"white"}})})}),Object(_.jsx)(s.a,{item:!0,xs:12,sm:12,md:6,children:Object(_.jsx)(N.a,{variant:"circle"===v?"outlined":"text",onClick:function(){f.getInstance().setState("selected-tool","circle")},children:Object(_.jsx)(Ce.a,{sx:{color:"white"}})})}),Object(_.jsx)(s.a,{item:!0,xs:12,sm:12,md:6,children:Object(_.jsx)(N.a,{variant:"triangle"===v?"outlined":"text",onClick:function(){f.getInstance().setState("selected-tool","triangle")},children:Object(_.jsx)(_e.a,{sx:{color:"white"}})})})]})}),Object(_.jsx)(Re.a,{}),Object(_.jsx)(Ee.a,{size:"small",value:o,min:2,"aria-label":"Small",valueLabelDisplay:"auto",onChange:function(e){var t;t=e.target.value,f.getInstance().setState("brush-size",t)}}),Object(_.jsx)(Re.a,{}),Object(_.jsx)(c.a,{mt:2,sx:{width:"100%",height:40,backgroundColor:n,border:1}})]})]})}var Me,Ge,Xe,qe,We,Je,He,Ve=n(76),Ke=n.n(Ve),Qe=n(77),Ze=n.n(Qe),$e=n(78),et=n.n($e),tt=n(79),nt=n.n(tt);function at(){return Object(_.jsx)(g.a,{children:Object(_.jsxs)(p.a,{style:{backgroundColor:"#3b4245"},children:[Object(_.jsx)(N.a,{onClick:st,children:Object(_.jsx)(Ke.a,{sx:{color:"white"}})}),Object(_.jsx)(N.a,{onClick:ct,children:Object(_.jsx)(Ze.a,{sx:{color:"white"}})}),Object(_.jsx)(N.a,{onClick:rt,children:Object(_.jsx)(et.a,{sx:{color:"white"}})}),Object(_.jsxs)(N.a,{component:"label",children:[Object(_.jsx)(nt.a,{sx:{color:"white"}}),Object(_.jsx)("input",{type:"file",hidden:!0,onChange:it})]})]})})}function rt(){var e=f.getInstance().serialize(),t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download","Drawing.meg"),document.body.appendChild(n),n.click(),n.remove()}function it(e){var t=new FileReader;t.onload=function(){t.result&&"string"===typeof t.result&&f.getInstance().initWith(t.result)},t.readAsText(e.target.files[0])}function st(){var e=f.getInstance().getState("cur-timeline-node"),t=f.getInstance().getState("timeline");e>0&&(f.getInstance().setState("layers",JSON.parse(JSON.stringify(t[e-1]))),f.getInstance().setState("cur-timeline-node",e-1))}function ct(){var e=f.getInstance().getState("cur-timeline-node"),t=f.getInstance().getState("timeline");e<t.length-1&&(f.getInstance().setState("layers",JSON.parse(JSON.stringify(t[e+1]))),f.getInstance().setState("cur-timeline-node",e+1))}function ot(){var e=Object(T.useState)(0),t=Object(d.a)(e,2),n=t[0],a=t[1],r=Object(T.useState)(0),i=Object(d.a)(r,2),s=i[0],c=i[1],o=Object(T.useState)(0),l=Object(d.a)(o,2),u=l[0],h=l[1],g=Object(T.useState)(0),b=Object(d.a)(g,2),p=b[0],v=b[1];function x(){var e=f.getInstance().getState("selection-rect-size"),t=f.getInstance().getState("selection-rect-pos");t&&e&&(e&&e.w<0&&e.h<0?(h(t.x+e.w),v(t.y+e.h)):e&&e.w<0?(h(t.x+e.w),v(t.y)):e&&e.h<0?(h(t.x),v(t.y+e.h)):(h(t.x),v(t.y)),e&&(c(Math.abs(e.h)),a(Math.abs(e.w))))}return f.getInstance().subscribe("selection-rect-pos",(function(){x()})),f.getInstance().subscribe("selection-rect-size",(function(){x()})),Object(_.jsx)("svg",{id:"selection-rect",height:s,width:n,style:{position:"absolute",top:p,left:u},children:Object(_.jsx)("rect",{x:"1",y:"1",height:s-2,width:n-2,style:{stroke:"#000000",strokeWidth:"1",strokeDasharray:"2 2",fill:"none"}})})}function lt(){return Object(T.useEffect)(ut),Object(_.jsx)(g.a,{children:Object(_.jsxs)(p.a,{style:{backgroundColor:"#3b4245"},children:[Object(_.jsx)("canvas",{id:"macanvas",width:"520",height:"550"}),Object(_.jsx)(ot,{})]})})}function ut(){Me=document.getElementById("macanvas");var e=document.getElementById("selection-rect");if(!Me||!e)throw new Error("Couldn't create the PAINT_CANVAS");(Ge=be.setupWebGL(Me,null))||alert("WebGL isn't available");var t=1e5;f.getInstance().setState("redraw",!1),f.getInstance().setState("newLine",!0),f.getInstance().setState("selection-start-coords",{x:0,y:0}),f.getInstance().setState("selection-end-coords",{x:0,y:0}),f.getInstance().setState("selection-top-left-coords",{x:0,y:0}),f.getInstance().setState("selection-bottom-right-coords",{x:0,y:0}),f.getInstance().setState("cropping",!1),f.getInstance().setState("selection-rect-pos",{x:0,y:0}),f.getInstance().setState("selection-rect-size",{w:0,h:0}),Ge.viewport(0,0,Me.clientWidth,Me.clientHeight),Ge.clearColor(.8,.8,.8,1),Xe=ge(Ge,xe,ye),Ge.useProgram(Xe),Ge.enable(Ge.DEPTH_TEST),(qe=Ge.createBuffer())&&me(Ge,Xe,"vPosition",qe,t,3,Ge.FLOAT),(We=Ge.createBuffer())&&me(Ge,Xe,"vBrushSize",We,t,1,Ge.FLOAT),(Je=Ge.createBuffer())&&me(Ge,Xe,"vBindingRect",Je,t,4,Ge.FLOAT),(He=Ge.createBuffer())&&me(Ge,Xe,"vColor",He,t,4,Ge.FLOAT),Me.addEventListener("mousedown",dt),e.addEventListener("mousedown",dt),Me.addEventListener("mouseup",ft),Me.addEventListener("mousemove",gt),e.addEventListener("mouseup",ft),e.addEventListener("mousemove",gt),document.addEventListener("keyup",(function(e){var t=f.getInstance().getState("cropping");"Escape"===e.code&&t&&(f.getInstance().setState("cropping",!1),function(){var e,t=xt(),n=f.getInstance().getState("cropping-layer");if(!t)return;(e=t.shapes).unshift.apply(e,Object(l.a)(n.shapes)),n.shapes=[],f.getInstance().setState("cropping-layer",n),f.getInstance().setState("selection-rect-size",{w:0,y:0})}(),vt())})),ht()}function ht(){Ge.clear(Ge.COLOR_BUFFER_BIT),Ge.clear(Ge.DEPTH_BUFFER_BIT),Ge.useProgram(Xe);var e=f.getInstance().getState("layers"),t=f.getInstance().getState("cropping-layer"),n=0,a=0;t.shapes.forEach((function(e,r){var i;Ge.bindBuffer(Ge.ARRAY_BUFFER,qe);for(var s=0;s<e.vertexData.length;s+=2)Ge.bufferSubData(Ge.ARRAY_BUFFER,12*n+s/2*3*4,fe([e.vertexData.slice(s,s+2),.1]));if(Ge.bindBuffer(Ge.ARRAY_BUFFER,We),Ge.bufferSubData(Ge.ARRAY_BUFFER,4*n,fe(Object(l.a)(e.brushSize))),Ge.bindBuffer(Ge.ARRAY_BUFFER,Je),Ge.bufferSubData(Ge.ARRAY_BUFFER,16*n,fe(e.boundingRectData)),Ge.bindBuffer(Ge.ARRAY_BUFFER,He),Ge.bufferSubData(Ge.ARRAY_BUFFER,16*n,fe(e.colorData)),"point"===e.type?n++:"nofill-rectangle"===e.type||"rectangle"===e.type?n+=4:"nofill-triangle"===e.type||"triangle"===e.type?n+=3:"nofill-elipse"!==e.type&&"elipse"!==e.type||(n+=32),(null===(i=t.shapes[r+1])||void 0===i?void 0:i.type)!==e.type||r===t.shapes.length-1){if("point"===e.type)Ge.drawArrays(Ge.POINTS,a,n-1-a);else if("nofill-rectangle"===e.type)for(var c=(n-a)/4,o=0;o<c;o++)Ge.drawArrays(Ge.LINE_LOOP,a+4*o,4);else if("rectangle"===e.type)for(var u=(n-a)/4,h=0;h<u;h++)Ge.drawArrays(Ge.TRIANGLE_FAN,a+4*h,4);else if("nofill-triangle"===e.type)for(var f=(n-a)/3,d=0;d<f;d++)Ge.drawArrays(Ge.LINE_LOOP,a+3*d,3);else if("triangle"===e.type)for(var g=(n-a)/3,b=0;b<g;b++)Ge.drawArrays(Ge.TRIANGLES,a+3*b,3);else if("nofill-elipse"===e.type)for(var p=(n-a)/32,v=0;v<p;v++)Ge.drawArrays(Ge.LINE_LOOP,a+32*v,32);else if("elipse"===e.type)for(var x=(n-a)/32,y=0;y<x;y++)Ge.drawArrays(Ge.TRIANGLE_FAN,a+32*y,32);a=n}})),e&&e.forEach((function(e,t){e.visible&&e.shapes.forEach((function(r,i){var s;Ge.bindBuffer(Ge.ARRAY_BUFFER,qe);for(var c=0;c<r.vertexData.length;c+=2)Ge.bufferSubData(Ge.ARRAY_BUFFER,12*n+c/2*3*4,fe([r.vertexData.slice(c,c+2),t/1e3]));if(Ge.bindBuffer(Ge.ARRAY_BUFFER,We),Ge.bufferSubData(Ge.ARRAY_BUFFER,4*n,fe(Object(l.a)(r.brushSize))),Ge.bindBuffer(Ge.ARRAY_BUFFER,Je),Ge.bufferSubData(Ge.ARRAY_BUFFER,16*n,fe(r.boundingRectData)),Ge.bindBuffer(Ge.ARRAY_BUFFER,He),Ge.bufferSubData(Ge.ARRAY_BUFFER,16*n,fe(r.colorData)),"point"===r.type?n++:"nofill-rectangle"===r.type||"rectangle"===r.type?n+=4:"nofill-triangle"===r.type||"triangle"===r.type?n+=3:"nofill-elipse"!==r.type&&"elipse"!==r.type||(n+=32),(null===(s=e.shapes[i+1])||void 0===s?void 0:s.type)!==r.type||i===e.shapes.length-1){if("point"===r.type)Ge.drawArrays(Ge.POINTS,a,n-1-a);else if("nofill-rectangle"===r.type)for(var o=(n-a)/4,u=0;u<o;u++)Ge.drawArrays(Ge.LINE_LOOP,a+4*u,4);else if("rectangle"===r.type)for(var h=(n-a)/4,f=0;f<h;f++)Ge.drawArrays(Ge.TRIANGLE_FAN,a+4*f,4);else if("nofill-triangle"===r.type)for(var d=(n-a)/3,g=0;g<d;g++)Ge.drawArrays(Ge.LINE_LOOP,a+3*g,3);else if("triangle"===r.type)for(var b=(n-a)/3,p=0;p<b;p++)Ge.drawArrays(Ge.TRIANGLES,a+3*p,3);else if("nofill-elipse"===r.type)for(var v=(n-a)/32,x=0;x<v;x++)Ge.drawArrays(Ge.LINE_LOOP,a+32*x,32);else if("elipse"===r.type)for(var y=(n-a)/32,m=0;m<y;m++)Ge.drawArrays(Ge.TRIANGLE_FAN,a+32*m,32);a=n}}))})),requestAnimationFrame(ht)}function ft(){var e=f.getInstance().getState("selected-tool"),t=f.getInstance().getState("cropping");f.getInstance().setState("redraw",!1),"brush"===e||"eraser"===e?vt():"crop"===e?t||(!function(){var e=f.getInstance().getState("selection-start-coords"),t=f.getInstance().getState("selection-end-coords"),n=f.getInstance().getState("selection-top-left-coords"),a=f.getInstance().getState("selection-bottom-right-coords"),r=f.getInstance().getState("cropping-layer"),i=xt();if(!i)return;e.x<t.x?(n.x=e.x,a.x=t.x):(n.x=t.x,a.x=e.x);e.y>t.y?(n.y=e.y,a.y=t.y):(n.y=t.y,a.y=e.y);var s=[];i.shapes.forEach((function(e){if("point"===e.type)for(var t=0;t<e.vertexData.length;t+=2){var i=M(e.vertexData[t],e.vertexData[t+1]);if(i[0]>n.x/Me.width*2-1&&i[0]<a.x/Me.width*2-1&&i[1]>a.y/Me.height*2-1&&i[1]<n.y/Me.height*2-1){var c={x1:e.boundingRectData[0],y1:e.boundingRectData[1],x2:e.boundingRectData[0]+e.boundingRectData[2],y2:e.boundingRectData[1]+e.boundingRectData[3]},o={x1:n.x,y1:a.y,x2:n.x+(a.x-n.x),y2:a.y+(n.y-a.y)},u=o.x1>c.x1?o.x1:c.x1,h=o.y1>c.y1?o.y1:c.y1,d=o.x2<c.x2?o.x2:c.x2,g=o.y2<c.y2?o.y2:c.y2;s.push({vertexData:Object(l.a)(e.vertexData),colorData:Object(l.a)(e.colorData),brushSize:Object(l.a)(e.brushSize),boundingRectData:[u,h,Math.abs(d-u),Math.abs(g-h)],type:e.type}),r.shapes=s,f.getInstance().setState("cropping-layer",r)}else;}}))}(),f.getInstance().setState("cropping",!0)):"rect"===e?(xt().shapes[0].type="rectangle",vt()):"circle"===e?(xt().shapes[0].type="elipse",vt()):"triangle"===e&&(xt().shapes[0].type="triangle",vt())}function dt(e){var t=f.getInstance().getState("selected-tool"),n=f.getInstance().getState("cropping");f.getInstance().setState("redraw",!0),f.getInstance().setState("new-line",!0),"brush"===t||"eraser"===t||("crop"===t?(f.getInstance().setState("selection-start-coords",{x:e.clientX-Me.offsetLeft,y:Me.height-(e.clientY-Me.offsetTop)}),n||f.getInstance().setState("selection-rect-pos",{x:e.clientX,y:e.clientY})):"rect"===t?function(e,t){var n=xt(),r=X.apply(a,Object(l.a)(f.getInstance().getState("picked-color"))),i=f.getInstance().getState("brush-size"),s=[0,0,Me.width,Me.height],c=M((e.x-Me.offsetLeft)/Me.width*2-1,(Me.height-e.y+Me.offsetTop)/Me.height*2-1),o=M((e.x+t.w-Me.offsetLeft)/Me.width*2-1,(Me.height-e.y+Me.offsetTop)/Me.height*2-1),u=M((e.x-Me.offsetLeft)/Me.width*2-1,(Me.height-(e.y+t.h)+Me.offsetTop)/Me.height*2-1),h=M((e.x+t.w-Me.offsetLeft)/Me.width*2-1,(Me.height-(e.y+t.h)+Me.offsetTop)/Me.height*2-1),d={vertexData:[].concat(Object(l.a)(c),Object(l.a)(o),Object(l.a)(h),Object(l.a)(u)),colorData:[].concat(Object(l.a)(r),Object(l.a)(r),Object(l.a)(r),Object(l.a)(r)),boundingRectData:[].concat(s,s,s,s),brushSize:[i,i,i,i],type:"nofill-rectangle"};n.shapes.unshift(d)}({x:e.clientX,y:e.clientY},{w:0,h:0}):"circle"===t?function(e,t){for(var n=M((e.x-Me.offsetLeft)/Me.width*2-1,(Me.height-e.y+Me.offsetTop)/Me.height*2-1),r=xt(),i=X.apply(a,Object(l.a)(f.getInstance().getState("picked-color"))),s=f.getInstance().getState("brush-size"),c=[0,0,Me.width,Me.height],u={vertexData:[],colorData:[],boundingRectData:[],brushSize:[],type:"nofill-elipse",center:Object(l.a)(n),size:Object(o.a)({},t)},h=Math.abs(t.w/Me.width),d=Math.abs(t.h/Me.height),g=0;g<32;g++){var b,p,v,x=M(n[0]+h*Math.cos(g*Math.PI/16),n[1]+d*Math.sin(g*Math.PI/16));(b=u.vertexData).push.apply(b,Object(l.a)(x)),(p=u.colorData).push.apply(p,Object(l.a)(i)),(v=u.boundingRectData).push.apply(v,c),u.brushSize.push(s)}r.shapes.unshift(u)}({x:e.clientX,y:e.clientY},{w:0,h:0}):"triangle"===t&&function(e,t){var n=xt(),r=X.apply(a,Object(l.a)(f.getInstance().getState("picked-color"))),i=f.getInstance().getState("brush-size"),s=[0,0,Me.width,Me.height],c=M((e.x-Me.offsetLeft)/Me.width*2-1,(Me.height-e.y+Me.offsetTop)/Me.height*2-1),o=M((e.x+t.w/2-Me.offsetLeft)/Me.width*2-1,(Me.height-(e.y+t.h)+Me.offsetTop)/Me.height*2-1),u=M((e.x-t.w/2-Me.offsetLeft)/Me.width*2-1,(Me.height-(e.y+t.h)+Me.offsetTop)/Me.height*2-1),h={vertexData:[].concat(Object(l.a)(o),Object(l.a)(u),Object(l.a)(c)),colorData:[].concat(Object(l.a)(r),Object(l.a)(r),Object(l.a)(r)),boundingRectData:[].concat(s,s,s),brushSize:[i,i,i],type:"nofill-triangle"};n.shapes.unshift(h)}({x:e.clientX,y:e.clientY},{w:0,h:0}))}function gt(e){var t=f.getInstance().getState("redraw"),n=f.getInstance().getState("selected-tool"),r=f.getInstance().getState("cropping");if(t)if("brush"===n)!function(e){var t=f.getInstance().getState("new-line"),n=xt();if(!n)return;var r=M((e.x-Me.offsetLeft)/Me.width*2-1,(Me.height-e.y+Me.offsetTop)/Me.height*2-1),i=X.apply(a,Object(l.a)(f.getInstance().getState("picked-color"))),s=f.getInstance().getState("brush-size"),c=[0,0,Me.width,Me.height],o=[r];if(t)f.getInstance().setState("new-line",!1);else{var u=n.shapes[0];bt(r,M(u.vertexData[0],u.vertexData[1]),o)}o.forEach((function(e){var t={vertexData:Object(l.a)(e),colorData:Object(l.a)(i),boundingRectData:[].concat(c),brushSize:[s],type:"point"};n.shapes.unshift(t)}))}({x:e.clientX,y:e.clientY});else if("eraser"===n)!function(e){var t=xt();if(!t)return;var n=f.getInstance().getState("brush-size")/Me.width,a=M((e.x-Me.offsetLeft)/Me.width*2-1,(Me.height-e.y+Me.offsetTop)/Me.height*2-1);t.shapes=t.shapes.filter((function(e){for(var t=0;t<e.vertexData.length;t+=2)return!(pt(e.vertexData.slice(t,t+2),a)<=n)}))}({x:e.clientX,y:e.clientY});else if("crop"===n)if(f.getInstance().setState("selection-end-coords",{x:e.clientX-Me.offsetLeft,y:Me.height-(e.clientY-Me.offsetTop)}),r)!function(e){var t=xt(),n=f.getInstance().getState("cropping-layer");if(!t||!n)return;n.shapes.forEach((function(t){for(var n=0;n<t.vertexData.length;n+=2)t.vertexData[n]+=e.x/Me.width*2,t.vertexData[n+1]+=e.y/Me.height*2;t.boundingRectData[0]+=e.x,t.boundingRectData[1]+=e.y}));var a=f.getInstance().getState("selection-rect-pos");f.getInstance().setState("selection-rect-pos",{x:a.x+e.x,y:a.y-e.y}),f.getInstance().setState("cropping-layer",n)}({x:e.movementX,y:-e.movementY});else{var i=f.getInstance().getState("selection-rect-pos"),s={x:e.clientX,y:e.clientY};f.getInstance().setState("selection-rect-size",{w:s.x-i.x,h:s.y-i.y})}else"rect"===n?function(e){var t=xt();t.shapes[0].vertexData[2]+=e.x/Me.width*2,t.shapes[0].vertexData[4]+=e.x/Me.width*2,t.shapes[0].vertexData[5]+=e.y/Me.height*2,t.shapes[0].vertexData[7]+=e.y/Me.height*2}({x:e.movementX,y:-e.movementY}):"circle"===n?function(e){var t=xt(),n=t.shapes[0].center,a=t.shapes[0].size;if(!n||!a)return;for(var r=[],i={w:a.w+2*e.x,h:a.h+2*e.y},s=Math.abs(i.w/Me.width),c=Math.abs(i.h/Me.height),u=0;u<32;u++){var h=M(n[0]+s*Math.cos(u*Math.PI/16),n[1]+c*Math.sin(u*Math.PI/16));r.push.apply(r,Object(l.a)(h))}t.shapes[0].vertexData=[].concat(r),t.shapes[0].size=Object(o.a)({},i)}({x:e.movementX,y:-e.movementY}):"triangle"===n&&function(e){var t=xt();t.shapes[0].vertexData[2]+=e.x/Me.width*2,t.shapes[0].vertexData[3]+=e.y/Me.height*2,t.shapes[0].vertexData[4]-=e.x/Me.width*2,t.shapes[0].vertexData[5]+=e.y/Me.height*2}({x:e.movementX,y:-e.movementY})}function bt(e,t,n){if(pt(e,t)>.01){var a=function(e,t){return M((e[0]+t[0])/2,(e[1]+t[1])/2)}(e,t);n.unshift(a),bt(e,a,n),bt(a,t,n)}}function pt(e,t){var n=Math.abs(e[0]-t[0]),a=Math.abs(e[1]-t[1]);return Math.sqrt(n*n+a*a)}function vt(){var e=f.getInstance().getState("layers"),t=f.getInstance().getState("cur-timeline-node"),n=f.getInstance().getState("timeline");t!==n.length-1&&(n=n.slice(0,t+1)),n.push(JSON.parse(JSON.stringify(e))),f.getInstance().setState("cur-timeline-node",n.length-1),f.getInstance().setState("timeline",n)}function xt(){var e=f.getInstance().getState("selectedLayer");return f.getInstance().getState("layers").find((function(t){return t.id===e}))}function yt(){return f.getInstance().setState("picked-color",[0,0,0,0]),f.getInstance().setState("brush-size",20),f.getInstance().setState("selected-tool","brush"),f.getInstance().setState("timeline",[[{name:"New Layer (".concat(1,")"),z_index:0,visible:!0,id:"".concat(0),shapes:[]}]]),f.getInstance().setState("cur-timeline-node",0),f.getInstance().setState("cropping-layer",{name:"CropLayer",z_index:0,visible:!0,id:"".concat(0),shapes:[]}),f.getInstance().setState("layers",[{name:"New Layer (".concat(1,")"),z_index:0,visible:!0,id:"".concat(0),shapes:[]}]),f.getInstance().setState("selectedLayer","0"),Object(_.jsx)("div",{className:"App",children:Object(_.jsx)(i.a,{children:Object(_.jsxs)(s.a,{container:!0,rowSpacing:1,columns:{xs:12,sm:12,md:12},children:[Object(_.jsx)(s.a,{item:!0,xs:12,sm:12,md:12,children:Object(_.jsx)(c.a,{mt:1,mb:2,children:Object(_.jsx)(at,{})})}),Object(_.jsx)(s.a,{item:!0,xs:12,sm:12,md:12,children:Object(_.jsxs)(s.a,{container:!0,rowSpacing:1,columns:{xs:12,sm:12,md:12},columnSpacing:{xs:1,sm:2,md:3},children:[Object(_.jsx)(s.a,{item:!0,xs:12,sm:6,md:2,children:Object(_.jsx)(Ue,{})}),Object(_.jsx)(s.a,{item:!0,xs:12,sm:6,md:6,children:Object(_.jsx)(lt,{})}),Object(_.jsxs)(s.a,{item:!0,xs:12,sm:6,md:4,children:[Object(_.jsx)(we,{}),Object(_.jsx)(c.a,{py:2,children:Object(_.jsx)(Y,{})})]})]})})]})})})}var mt=document.getElementById("root");Object(r.render)(Object(_.jsx)(yt,{}),mt)},93:function(e,t,n){}},[[102,1,2]]]);
//# sourceMappingURL=main.044bfa50.chunk.js.map